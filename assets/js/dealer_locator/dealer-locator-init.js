window.Helper={isMobile:function(){return jQuery("#mobile").is(":visible")},isTablet:function(){return jQuery("#tablet").is(":visible")}},window.DealerLocator=function(e){this.dom=jQuery(e),this.dom.length&&(this.templator=new DealerLocator.Templator,this.map=new DealerLocator.Map(this),this.searchMenu=new DealerLocator.SearchMenu(this),this.pageBrandtore=new DealerLocator.Page.PageBrandtore(this),this.pagePartner=new DealerLocator.Page.PagePartner(this),this.init(),this.initEvent(),this.openPage())},DealerLocator.prototype={dom:null,map:null,templator:null,searchMenu:null,pageBrandtore:null,pagePartner:null,init:function(){this.map.init(),this.searchMenu.init(),DealerLocator.Select.build(this.dom.find("select"))},initEvent:function(){var e=this;jQuery(window).scroll(function(){var e=jQuery(this).scrollTop(),t=jQuery(".dealer-page-close-global");e<46?t.css({top:46-e+10+"px"}):t.css({top:"10px"})}),jQuery(window).on({popstate:function(t){var o=e.getJsonFromUrl();o.lat&&o.lng&&e.map.googleMap.panTo(new google.maps.LatLng(parseFloat(o.lat,10),parseFloat(o.lng,10)));var r=parseInt(o.zoom,10);r>=3&&r<=30&&e.map.googleMap.setZoom(r);var a=window.location.href.split("?")[0];a==e.dom.attr("data-url-page-brandtores")&&e.pageBrandtore.open(),a==e.dom.attr("data-url-page-onlinepartners")&&e.pagePartner.open(),a==e.dom.attr("data-url-page-locator")&&(e.pageBrandtore.isOpen&&e.pageBrandtore.close(),e.pagePartner.isOpen&&e.pagePartner.close())}})},pushState:function(e,t,o){e=e||jQuery("title").html(),t=t||window.location.href.split("?")[0],o=o||{};var r=this.getJsonFromUrl();for(var a in o)"undefined"===o[a]||null===o[a]||void 0===o[a]||""===o[a]?delete r[a]:r[a]=o[a];for(var a in r)"undefined"!==r[a]&&null!==r[a]&&r[a]!==r&&""!==r[a]||delete r[a];t+="?"+jQuery.param(r),window.location.href!=t&&(history.pushState({},e,t),jQuery("title").html(e))},getJsonFromUrl:function(){var e=location.search.substr(1),t={};return e.split("&").forEach(function(e){var o=e.split("=");t[o[0]]=decodeURIComponent(o[1])}),t},openPage:function(){var e=this.dom.attr("data-origin");"brandstores"==e&&this.pageBrandtore.open(),"onlinepartners"==e&&this.pagePartner.open()}},DealerLocator.Select=function(e){this.domSelect=e,this.init(),this.initEvent()},DealerLocator.Select.build=function(e){for(var t=jQuery(e),o=0;o<t.length;o++)new this(jQuery(t[o]))},DealerLocator.Select.currentOpennedSelect=null,DealerLocator.Select.prototype={dom:null,domSelect:null,domValue:null,domOptions:null,init:function(){var e=this;this.dom=jQuery('<span class="locator-select-wrapper" ><span class="locator-select-value">&nbsp;</span></span>').insertBefore(this.domSelect).append(this.domSelect),this.domValue=this.dom.find(".locator-select-value"),this.domOptions=jQuery('<ul class="locator-select-options" style="display:none; position: absolute; z-index: 5;" ></ul>').appendTo(document.body),this.domSelect.hide();for(var t=this.domSelect.find("option"),o=0;o<t.length;o++){var r=jQuery(t[o]),a=r.attr("class");a=a||"";var n=jQuery('<li class="'+a+'" data-value="'+r.val()+'" >'+r.html()+"</li>").appendTo(this.domOptions);!function(t){t.click(function(o){o.preventDefault(),e.select(t.attr("data-value"))})}(n),r.is(":selected")&&this.select(r.val(),!1)}},initEvent:function(){var e=this,t=!1;this.dom.click(function(o){Helper.isMobile()||(o.preventDefault(),e.toggle(),t=!0)}),this.domOptions.click(function(){t=!0}),jQuery(document.body).click(function(o){!t&&e.isOpen()&&e.close(),t=!1}),this.domSelect.change(function(){e.updateLabel()}),jQuery(window).resize(function(){e.updatePosition()}),jQuery(window).scroll(function(){e.updatePosition()})},isOpen:function(){return this.dom.hasClass("open")},open:function(){this.dom.addClass("open"),this.domOptions.show();var e=this.domOptions.outerHeight();this.updatePosition(),this.domOptions.css({height:"0px"}),this.domOptions.animate({height:e+"px"},300),DealerLocator.Select.currentOpennedSelect=this},updatePosition:function(){if(this.isOpen()){var e=this.dom.offset(),t=jQuery(window),o=e.top,r=e.left;o+this.domOptions.outerHeight()+this.dom.height()-t.scrollTop()>t.height()?this.domOptions.css({top:"",bottom:jQuery(document.body).outerHeight()-o-1+"px",left:r+"px",width:this.dom.outerWidth()+"px"}):this.domOptions.css({top:o+this.dom.height()+"px",bottom:"",left:r+"px",width:this.dom.outerWidth()+"px"})}},close:function(){var e=this;this.domOptions.animate({height:"0px"},300,function(){e.domOptions.hide(),e.domOptions.css({height:""}),e.dom.removeClass("open"),DealerLocator.Select.currentOpennedSelect==e&&(DealerLocator.Select.currentOpennedSelect=null)})},toggle:function(){this.isOpen()?this.close():this.open()},updateLabel:function(){var e=this.domOptions.find('li[data-value="'+this.domSelect.val()+'"]');this.domValue.html(e.html()),this.domValue.attr("class","locator-select-value "+e.attr("class"))},select:function(e,t){t=void 0===t||t;var o=this.domSelect.val(),r=this.domOptions.find('li[data-value="'+e+'"]');this.domOptions.find("li").removeClass("selected"),r.addClass("selected"),this.domSelect.val(e),t&&e!=o?this.domSelect.trigger("change"):this.updateLabel(),this.close()}},DealerLocator.Templator=function(){this.precompiledTemplates=[]},DealerLocator.Templator.prototype={precompiledTemplates:null,render:function(e,t){if(t=t||{},!this.precompiledTemplates[e]){var o=jQuery.trim(jQuery('script[data-template-id="'+e+'"]').html());this.precompiledTemplates[e]=this.compileTemplate(o)}var r=this.precompiledTemplates[e],a=r(t);return jQuery("<div>").append(jQuery.parseHTML(a))},compileTemplate:function(e){for(var t="var out = [];",o=e.split("%>"),r=0,a=o.length;r<a;r++){var n=o[r].split("<%");if(n[0]){t+='out.push("'+n[0].replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\"/g,'\\"')+'");'}n[1]&&("="===n[1].charAt(0)?t+="out.push("+n[1].slice(1)+");":t+=n[1])}return t+="return out.join('');",new Function("data",t)}},DealerLocator.Map=function(e){this.locator=e,this.dom=e.dom.find("#map-shops"),this.btSearch=e.dom.find(".bt-search"),this.zoom=e.dom.attr("data-map-zoom"),this.lat=e.dom.attr("data-map-lat"),this.lng=e.dom.attr("data-map-lng"),this.markerManager=new DealerLocator.Map.MarkerManager(this)},DealerLocator.Map.prototype={locator:null,dom:null,markerManager:null,styles:null,googleMap:null,searchBox:null,btSearch:null,zoom:null,lat:null,lng:null,init:function(){this.initStyle(),this.initApi(),this.initSearchBox(),this.initEvents()},initStyle:function(){this.styles=[{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#f2f2f2"},{visibility:"simplified"}]},{featureType:"road",elementType:"labels.icon",stylers:[{saturation:-100},{lightness:50}]},{featureType:"road.highway",elementType:"geometry",stylers:[{visibility:"simplified"},{color:"#d6d6d6"}]},{featureType:"road.local",elementType:"geometry",stylers:[{visibility:"simplified"},{color:"#dedede"}]},{featureType:"transit",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"geometry",stylers:[{visibility:"on"},{color:"#dfeae8"}]}]},initApi:function(){var e,t,o=this,r=o.locator.getJsonFromUrl(),a=!0;r.lat&&r.lng?(e=new google.maps.LatLng(parseFloat(r.lat,10),parseFloat(r.lng,10)),a=!1):o.lat&&o.lng?(e=new google.maps.LatLng(parseFloat(o.lat,10),parseFloat(o.lng,10)),a=!1):e=new google.maps.LatLng(40.7967667,-74.4815438),o.zoom&&!r.zoom?t=parseInt(o.zoom,10):t>=3&&t<=30||(t=3),this.googleMap=new google.maps.Map(this.dom[0],{zoom:t,maxZoom:30,minZoom:3,disableDefaultUI:!0,styles:this.styles,center:e,mapTypeId:google.maps.MapTypeId.ROADMAP}),a&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){initialLocation=new google.maps.LatLng(e.coords.latitude,e.coords.longitude),o.googleMap.setCenter(initialLocation),o.googleMap.setZoom(12)},function(e){o.localizeFail(e)})},initSearchBox:function(){this.searchBox=new google.maps.places.Autocomplete(this.getSearchMenu().inputSearch[0],{types:["geocode"],placeIdOnly:!0}),google.maps.event.clearInstanceListeners(this.searchBox)},initEvents:function(){var e=this;this.btSearch.click(function(){e.runSearch()}),this.searchBox.addListener("place_changed",function(){e.placesChanged()}),this.googleMap.addListener("bounds_changed",function(){e.searchBox.setBounds(e.googleMap.getBounds())});var t=!0;this.googleMap.addListener("idle",function(){e.refresh();var o=e.googleMap.getCenter(),r={zoom:e.googleMap.getZoom(),lat:Math.round(1e4*o.lat())/1e4,lng:Math.round(1e4*o.lng())/1e4};t||e.locator.pushState(null,null,r),t=!1}),this.dom.click(function(){jQuery("input").blur()}),jQuery(document.body).keyup(function(t){jQuery("input").is(":focus")||DealerLocator.Page.currentPageOpen||(109==t.keyCode?e.googleMap.setZoom(e.googleMap.getZoom()-1):107==t.keyCode&&e.googleMap.setZoom(e.googleMap.getZoom()+1))}),this.locator.dom.find(".map-control-more").click(function(t){t.preventDefault(),e.zoomIn()}),this.locator.dom.find(".map-control-less").click(function(t){t.preventDefault(),e.zoomOut()})},zoomIn:function(){var e=this.googleMap.getZoom();e<30&&this.googleMap.setZoom(e+1)},zoomOut:function(){var e=this.googleMap.getZoom();e>3&&this.googleMap.setZoom(e-1)},refresh:function(){var e=this;if(this.googleMap.getZoom()>=6){var t=this.googleMap.getBounds(),o=t.getSouthWest().lat(),r=t.getSouthWest().lng(),a=t.getNorthEast().lat(),n=t.getNorthEast().lng(),i=this.locator.dom.attr("data-url-marker")+"?xmin="+o+"&xmax="+a+"&ymin="+r+"&ymax="+n,s=this.getSearchMenu().avancedMenu.getRangesValue(),l=this.getSearchMenu().avancedMenu.getSpecificitiesValue();s.length&&(i+="&sports="+s.join(",")),l.length&&(i+="&specificities="+l.join(",")),jQuery.ajax(i,{async:!0,dataType:"json",success:function(t){e.success(t)},error:function(e,t,o){}})}else this.clear()},success:function(e){e?this.markerManager.update(e.shops):this.clear()},clear:function(){this.markerManager.clear()},localizeMe:function(){var e=this;navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){var o={lat:t.coords.latitude,lng:t.coords.longitude};e.googleMap.panTo(o),e.googleMap.setZoom(10)},function(t){e.localizeFail(t)})},localizeFail:function(e){this.getSearchMenu().btLocalize.remove()},runSearch:function(){var e=this,t=this.getSearchMenu().inputSearch.val();if(t){(new google.maps.Geocoder).geocode({address:t},function(t,o){if(o==google.maps.GeocoderStatus.OK){var r=t[0];e.getSearchMenu().inputSearch.val(r.address_components[0].long_name+(r.address_components[1]?", "+r.address_components[1].long_name:"")+(r.address_components[4]?", "+r.address_components[4].long_name:"")),e.googleMap.panTo(r.geometry.location),e.googleMap.setZoom(10)}})}else this.getSearchMenu().inputSearch.focus()},placesChanged:function(){var e=this,t=this.searchBox.getPlace();(new google.maps.Geocoder).geocode({placeId:t.place_id},function(o,r){if("OK"===r){var a=new google.maps.LatLngBounds;t=o[0],t.geometry.viewport?a.union(t.geometry.viewport):a.extend(t.geometry.location),e.googleMap.fitBounds(a)}else console.log("Geocode was not successful for the following reason: "+r);var n=o[0].address_components,i="",s="",l="",c="";for(j=0;j<n.length;++j){var h=n[j].types;for(k=0;k<h.length;++k)"locality"==h[k]&&(i=n[j].long_name),"administrative_area_level_1"==h[k]&&(l=n[j].long_name),"country"==h[k]&&(s=n[j].long_name),"postal_code"==h[k]&&(c=n[j].long_name)}_track("siteInteraction",{events:{click:!0,locatorSearch:!0},interaction:{type:"store-locator",name:"search"},locator:{country:s,city:i+","+l,zipcode:c}})})},getSearchMenu:function(){return this.locator.searchMenu}},DealerLocator.Map.MarkerManager=function(e){this.map=e,this.markers={},this.clusteredMarkers={brandstore:{},partner:{},retailer:{}}},DealerLocator.Map.MarkerManager.CLUSTERED_GRID_SIZE=100,DealerLocator.Map.MarkerManager.prototype={map:null,markers:null,lengthStore:null,lastZoom:null,clusteredMarkers:null,update:function(e){this.resetClustered(),this.lengthStore={brandstore:0,partner:0,retailer:0};for(var t={},o=0;o<e.length;o++){var r=e[o],a=r.shopId,n=this.markers[a];n?delete this.markers[a]:n=DealerLocator.Map.Marker.create(this,r),this.lengthStore[n.type]++,this.map.googleMap.getZoom()<13&&(n=this.clusteredTheMarker(n)),t[a]=n,n.show()}for(var o in this.markers)this.markers[o].remove();this.markers=t,this.getLegend().displayNbShop()},clear:function(){for(var e in this.markers)this.markers[e].remove();this.markers={},this.size=0,this.lengthStore={brandstore:0,partner:0,retailer:0},this.getLegend().displayNbShop()},resetClustered:function(){for(var e in this.markers)if(this.markers[e]instanceof DealerLocator.Map.MarkerClustered){var t=this.markers[e];this.markers[e]=t.subMarkers[e],this.markers[e].show(),t.removeSubMarker(e)}for(var o in this.clusteredMarkers)for(var e in this.clusteredMarkers[o])this.clusteredMarkers[o][e].destroy&&this.clusteredMarkers[o][e].destroy();this.clusteredMarkers={brandstore:{},partner:{},retailer:{}};var r=this.map.googleMap,a=Math.pow(2,r.getZoom()),n=new google.maps.LatLng(r.getBounds().getNorthEast().lat(),r.getBounds().getSouthWest().lng()),i=r.getProjection().fromLatLngToPoint(n);Math.floor(i.x*a)},clusteredTheMarker:function(e){var t=this.map.googleMap,o=Math.pow(2,t.getZoom()),r=parseInt(parseFloat(e.infos.coordX,10)*o/DealerLocator.Map.MarkerManager.CLUSTERED_GRID_SIZE,10)+"_"+parseInt(parseFloat(e.infos.coordY,10)*o/DealerLocator.Map.MarkerManager.CLUSTERED_GRID_SIZE,10);return this.clusteredMarkers[e.type][r]?this.clusteredMarkers[e.type][r]instanceof DealerLocator.Map.MarkerClustered?this.clusteredMarkers[e.type][r].pushSubMarker(e):this.clusteredMarkers[e.type][r]=new DealerLocator.Map.MarkerClustered(this,this.clusteredMarkers[e.type][r],e):this.clusteredMarkers[e.type][r]=e,this.clusteredMarkers[e.type][r]},getLocator:function(){return this.map.locator},getLegend:function(){return this.getLocator().searchMenu.legend}},DealerLocator.Map.Marker=function(e,t){this.manager=e,this.infos=t,this.googleMarker=new google.maps.Marker({position:new google.maps.LatLng(t.coordX,t.coordY),map:this.getMap().googleMap,icon:this.getIconUrl()}),this.initTooltip(),this.initInfoBox(),this.initEvent()},DealerLocator.Map.Marker.TYPE_BRANDSTORE="brandstore",DealerLocator.Map.Marker.TYPE_PARTNER="partner",DealerLocator.Map.Marker.TYPE_RETAILER="retailer",DealerLocator.Map.Marker.create=function(e,t){switch(t.category){case"Brandstore":return new DealerLocator.Map.MarkerBrandstore(e,t);case"Partners":return new DealerLocator.Map.MarkerPartner(e,t);case"Retailers":default:return new DealerLocator.Map.MarkerRetailer(e,t)}},DealerLocator.Map.Marker.prototype={manager:null,infos:null,type:null,googleMarker:null,tooltip:null,infoBox:null,initEvent:function(){},initTooltip:function(){this.tooltip=new DealerLocator.Map.Marker.Tooltip(this)},initInfoBox:function(){this.infoBox=new DealerLocator.Map.Marker.InfoBox(this)},getId:function(){return this.infos.shopId},updatePosition:function(){this.googleMarker.setPosition(new google.maps.LatLng(this.infos.coordX,this.infos.coordY))},remove:function(){this.removeFromMap(),this.tooltip.hide(),this.infoBox.onRemove()},removeFromMap:function(){this.googleMarker.setMap(null)},show:function(){this.googleMarker.setMap(this.getMap().googleMap)},getOffsetScreen:function(){var e=this.getMap().googleMap,t=Math.pow(2,e.getZoom()),o=new google.maps.LatLng(e.getBounds().getNorthEast().lat(),e.getBounds().getSouthWest().lng()),r=e.getProjection().fromLatLngToPoint(o),a=e.getProjection().fromLatLngToPoint(this.googleMarker.getPosition());return new google.maps.Point(Math.floor((a.x-r.x)*t),Math.floor((a.y-r.y)*t))},getLocator:function(){return this.manager.getLocator()},getMap:function(){return this.manager.map},getIconUrl:function(){return this.getLocator().dom.attr("data-icon-"+this.type)}},DealerLocator.Map.MarkerBrandstore=function(e,t){this.type=DealerLocator.Map.Marker.TYPE_BRANDSTORE,DealerLocator.Map.Marker.call(this,e,t)},DealerLocator.Map.MarkerBrandstore.prototype=Object.create(DealerLocator.Map.Marker.prototype),DealerLocator.Map.MarkerPartner=function(e,t){this.type=DealerLocator.Map.Marker.TYPE_PARTNER,DealerLocator.Map.Marker.call(this,e,t)},DealerLocator.Map.MarkerPartner.prototype=Object.create(DealerLocator.Map.Marker.prototype),DealerLocator.Map.MarkerRetailer=function(e,t){this.type=DealerLocator.Map.Marker.TYPE_RETAILER,DealerLocator.Map.Marker.call(this,e,t)},DealerLocator.Map.MarkerRetailer.prototype=Object.create(DealerLocator.Map.Marker.prototype),DealerLocator.Map.MarkerClustered=function(e,t,o){this.type=t.type,this.manager=e,this.initInfos(t),DealerLocator.Map.Marker.call(this,e,this.infos),this.subMarkers={},this.subMarkers[t.getId()]=t,this._minX=this.infos.coordX,this._minY=this.infos.coordY,this._maxX=this.infos.coordX,this._maxY=this.infos.coordY,t.removeFromMap(),this.pushSubMarker(o),this.googleMarker.setMap(this.getMap().googleMap)},DealerLocator.Map.MarkerClustered.prototype=Object.create(DealerLocator.Map.Marker.prototype),jQuery.extend(DealerLocator.Map.MarkerClustered.prototype,{subMarkers:null,size:1,_minX:0,_minY:0,_maxX:0,_maxY:0,initEvent:function(){var e=this;this.googleMarker.addListener("click",function(){var t=e.getMap().googleMap.getZoom(),o=3;t>9&&(o=2),t>11&&(o=1),e.getMap().googleMap.setZoom(t+o),e.getMap().googleMap.panTo(e.googleMarker.position)})},initTooltip:function(){},initInfoBox:function(){},initInfos:function(e){this.infos={coordX:e.infos.coordX,coordY:e.infos.coordY}},getId:function(){return null},remove:function(){this.removeFromMap()},destroy:function(){for(var e in this.subMarkers)this.subMarkers[e].remove();this.subMarkers={},this.remove()},pushSubMarker:function(e){this.subMarkers[e.getId()]=e,this.size++,e.removeFromMap(),this._minX=e.infos.coordX<this._minX?e.infos.coordX:this._minX,this._minY=e.infos.coordY<this._minY?e.infos.coordY:this._minY,this._maxX=e.infos.coordX>this._maxX?e.infos.coordX:this._maxX,this._maxY=e.infos.coordY>this._maxY?e.infos.coordY:this._maxY,this.infos={coordX:(parseFloat(this._minX,10)+parseFloat(this._maxX,10))/2,coordY:(parseFloat(this._minY,10)+parseFloat(this._maxY,10))/2},this.updatePosition(),this.googleMarker.setIcon(this.getIconUrl())},removeSubMarker:function(e){return this.subMarkers[e]&&(delete this.subMarkers[e],--this.size||this.remove()),null},getIconUrl:function(){return this.getLocator().dom.attr("data-icon-clustered")+"?type="+this.type+"&number="+this.size}}),DealerLocator.Map.Marker.Tooltip=function(e){this.marker=e,this.mainDom=jQuery("#locator-tooltips"),this.init(),this.initEvent()},DealerLocator.Map.Marker.Tooltip.prototype={marker:null,dom:null,mainDom:null,initEvent:function(){var e=this;this.marker.googleMarker.addListener("mouseover",function(t){var o=(e.marker.getOffsetScreen(),!0);for(var r in DealerLocator.Map.Marker.InfoBox.currentOpen)o=!1;o&&e.show()}),this.marker.googleMarker.addListener("mouseout",function(){e.hide()}),this.marker.getMap().googleMap.addListener("drag",function(){e.hide()})},init:function(){this.dom=this.getTemplator().render("tooltip",{text:this.marker.infos.name}).find(" > *"),this.draw()},draw:function(){var e=this.marker.getOffsetScreen();this.dom.css({left:e.x+"px",bottom:this.getMap().dom.height()-e.y+"px"})},hide:function(){this.dom.remove()},show:function(){this.marker.infoBox.isOpen()||(this.draw(),this.dom.appendTo(this.mainDom))},getMap:function(){return this.marker.getMap()},getLocator:function(){return this.marker.getLocator()},getTemplator:function(){return this.getLocator().templator}},DealerLocator.Map.Marker.InfoBox=function(e){this.id=++DealerLocator.Map.Marker.InfoBox.count,this.marker=e,this.domMainMobile=jQuery("#locator-infosbox-mobile"),this.initEvent()},DealerLocator.Map.Marker.InfoBox.currentOpen={},DealerLocator.Map.Marker.InfoBox.count=0,DealerLocator.Map.Marker.InfoBox.removeAll=function(){for(var e in DealerLocator.Map.Marker.InfoBox.currentOpen)DealerLocator.Map.Marker.InfoBox.currentOpen[e].onRemove();DealerLocator.Map.Marker.InfoBox.currentOpen={}},DealerLocator.Map.Marker.InfoBox.addOpenBox=function(e){DealerLocator.Map.Marker.InfoBox.currentOpen[e.id]=e},DealerLocator.Map.Marker.InfoBox.removeOpenBox=function(e){delete DealerLocator.Map.Marker.InfoBox.currentOpen[e.id]},DealerLocator.Map.Marker.InfoBox.prototype=Object.create(google.maps.OverlayView.prototype),jQuery.extend(DealerLocator.Map.Marker.InfoBox.prototype,{marker:null,domMainMobile:null,dom:null,id:0,ajaxCalled:!1,initEvent:function(){var e=this;this.marker.googleMarker.addListener("click",function(){void 0!==e.getLocator().searchMenu&&e.getLocator().searchMenu.legend.close(),e.onAdd(),e.centerOnMap()})},initDomEvent:function(){var e=this;this.dom.find(".infoBox-close").click(function(){e.onRemove()})},initDomResultEvent:function(){},isOpen:function(){return!!this.getMap()},centerOnMap:function(){var e=this.getMapObj().googleMap,t=e.getProjection(),o=this.marker.googleMarker.getPosition(),r=t.fromLatLngToPoint(o),a=Math.pow(2,e.getZoom()),n=(new google.maps.LatLng(e.getBounds().getNorthEast().lat(),e.getBounds().getSouthWest().lng()),this.getMapObj().dom.height());if(Helper.isMobile()){var i=n/4-60;r.y+=i/a}else{var i=-n/2+180;n<660&&(i=n/2-455),r.x+=110/a,r.y+=i/a}e.panTo(t.fromPointToLatLng(r))},onAdd:function(){if(DealerLocator.Map.Marker.InfoBox.removeAll(),this.setMap(this.getMapObj().googleMap),DealerLocator.Map.Marker.InfoBox.addOpenBox(this),this.dom||(this.dom=this.getTemplator().render("infoBox").find(" > *"),this.getDetails()),Helper.isMobile())this.domMainMobile.append(this.dom);else{var e=this.getPanes();e&&this.dom.appendTo(e.floatPane)}this.initDomEvent(),this.initDomResultEvent(),this.marker.tooltip.hide()},onRemove:function(){this.dom&&this.dom.remove(),this.setMap(null),DealerLocator.Map.Marker.InfoBox.removeOpenBox(this)},draw:function(){var e=this.getProjection();if(this.dom&&e){var t=e.fromLatLngToDivPixel(this.marker.googleMarker.getPosition());this.dom.css({left:t.x+"px",bottom:-t.y+"px"})}},getDetails:function(){if(!this.ajaxCalled){this.ajaxCalled=!0;var e=this,t=this.getLocator().dom.attr("data-url-details").replace("ID_STORE",this.marker.getId());jQuery.ajax(t,{async:!0,dataType:"json",success:function(t){e.success(t)},error:function(e,t,o){}})}},success:function(e){if(e){var t=this.getTemplator().render("infoBox-result",e.shop[0]),o=this.dom.find(".infobox-inner");o.empty(),o.append(t.contents()),this.initDomResultEvent(),void 0==e.shop[0].city&&void 0==e.shop[0].country&&void 0==e.shop[0].postal_code||_track("siteInteraction",{events:{click:!0,locatorDetails:!0},interaction:{type:"store-locator",name:"details-click"},locator:{country:e.shop[0].country,city:e.shop[0].city,zipcode:e.shop[0].postal_code}})}},getMapObj:function(){return this.marker.getMap()},getLocator:function(){return this.marker.getLocator()},getTemplator:function(){return this.getLocator().templator}}),DealerLocator.SearchMenu=function(e){this.locator=e,this.dom=e.dom.find(".sectionLoc"),this.inputSearch=this.dom.find("#find-area"),this.btLocalize=this.dom.find("#localize"),this.avancedMenu=new DealerLocator.SearchMenu.AvancedSearchMenu(this),this.legend=new DealerLocator.SearchMenu.Legend(this),console.log(this.locator),console.log(this.dom)},DealerLocator.SearchMenu.prototype={locator:null,avancedMenu:null,legend:null,dom:null,inputSearch:null,btLocalize:null,init:function(){this.initEvent()},initEvent:function(e){var t=this;navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(){t.btLocalize.click(function(e){e.preventDefault(),Helper.isMobile()&&t.avancedMenu.close(),t.getMap().localizeMe()})},function(e){t.btLocalize.remove()}),this.inputSearch.focus(function(){Helper.isMobile()&&t.avancedMenu.close()}),this.inputSearch.blur(function(){t.getMap().dom.focus()}),this.inputSearch.keypress(function(e){!e&&window.event&&(e=window.event),13==e.keyCode&&(e.returnValue=!1,e.cancelBubble=!0),13==e.keyCode&&(e.preventDefault(),e.stopPropagation())}),this.getMap().dom.click(function(){t.avancedMenu.close()})},getMap:function(){return this.locator.map}},DealerLocator.SearchMenu.AvancedSearchMenu=function(e){this.menu=e,this.dom=e.dom.find("#advanced-search-content"),this.button=e.dom.find(".advanced-search-btn"),this.checkRanges=this.dom.find(".filters-box.ranges input"),this.checkSpecificities=this.dom.find(".filters-box.specificities input"),this.initEvent()},DealerLocator.SearchMenu.AvancedSearchMenu.ANIMATE_TIME=200,DealerLocator.SearchMenu.AvancedSearchMenu.prototype={menu:null,dom:null,button:null,checkRanges:null,checkSpecificities:null,scrollToUp:!1,initEvent:function(){var e=this;this.button.click(function(t){return t.preventDefault(),e.isOpen()?e.close():e.open(),!1}),this.checkRanges.change(function(){e.getMap().refresh()}),this.checkSpecificities.change(function(){e.getMap().refresh()})},isOpen:function(){return this.dom.is(":visible")},open:function(){jQuery(document.body).addClass("dealer-locator-asearch-open"),jQuery(document.body).removeClass("dealer-locator-asearch-close"),this.scrollToUp=!1,Helper.isMobile()&&(this.scrollToUp=0==jQuery("html, body").scrollTop(),this.scrollToUp&&jQuery("html, body").animate({scrollTop:jQuery("header").height()},300)),this.dom.css({display:"block"}),this.dom.css({"margin-bottom":-this.dom.outerHeight()+"px"}),this.dom.animate({"margin-bottom":"0px"},DealerLocator.SearchMenu.AvancedSearchMenu.ANIMATE_TIME)},close:function(){var e=this;jQuery(document.body).removeClass("dealer-locator-asearch-open"),jQuery(document.body).addClass("dealer-locator-asearch-close"),this.scrollToUp&&jQuery("html, body").animate({scrollTop:0},0),this.dom.animate({"margin-bottom":-this.dom.outerHeight()+"px"},DealerLocator.SearchMenu.AvancedSearchMenu.ANIMATE_TIME,function(){e.dom.css({display:"none","margin-bottom":"0px"})})},getRangesValue:function(){return jQuery.map(this.checkRanges.filter(":checked"),function(e){return+e.value})},getSpecificitiesValue:function(){return jQuery.map(this.checkSpecificities.filter(":checked"),function(e){return+e.value})},getMap:function(){return this.menu.getMap()}},DealerLocator.SearchMenu.Legend=function(e){this.menu=e,this.dom=e.dom.find(".legend"),this.initEvent()},DealerLocator.SearchMenu.Legend.prototype={menu:null,dom:null,initEvent:function(){var e=this;this.dom.click(function(t){e.toggle()})},toggle:function(){this.isOpen()?this.close():this.open()},isOpen:function(){return this.dom.hasClass("open")},open:function(){this.dom.addClass("open")},close:function(){this.dom.removeClass("open")},displayNbShop:function(){this.dom.find(".brandstore > em").text("("+this.getMarkerManager().lengthStore.brandstore+")"),this.dom.find(".retailers > em").text("("+this.getMarkerManager().lengthStore.retailer+")"),this.dom.find(".preferred > em").text("("+this.getMarkerManager().lengthStore.partner+")")},getMarkerManager:function(){return this.menu.getMap().markerManager}},DealerLocator.Page=function(e,t){this.locator=e,this.buttonClose=jQuery(".dealer-page-close"),this.dom=jQuery("#"+t),this.id=t,this.urlPage=this.locator.dom.attr("data-url-page-locator"),this.titlePage=this.locator.dom.attr("data-title-page-locator"),this.closeUrlPage=this.locator.dom.attr("data-url-page-locator"),this.closeTitlePage=this.locator.dom.attr("data-title-page-locator"),this.btActive=jQuery(".dealer-map-bt"),this.initEvent(),DealerLocator.Page.pages.push(this)},DealerLocator.Page.pages=[],DealerLocator.Page.currentPageOpen=null,DealerLocator.Page.prototype={locator:null,buttonClose:null,btActive:null,dom:null,id:null,isOpen:!1,urlPage:null,titlePage:null,closeTitlePage:null,closeUrlPage:null,initEvent:function(){var e=this;this.buttonClose.click(function(t){return t.preventDefault(),e.close(),!1}),jQuery(window).resize(function(){e.placeOnOpen()})},placeOnOpen:function(e){if(this.isOpen||e){jQuery(".sectionLoc").css({bottom:jQuery(window).height()-270+"px"})}},open:function(){var e=this;if(jQuery(".sectionLoc-title").removeClass("active"),this.btActive.addClass("active"),!this.isOpen){if(this.locator.searchMenu.avancedMenu.close(),DealerLocator.Page.currentPageOpen){this.dom.parent().find(" > div").hide();for(var t=0;t<DealerLocator.Page.pages.length;t++)DealerLocator.Page.pages[t].isOpen=!1;this.dom.show(),this.isOpen=!0}else DealerLocator.Page.currentPageOpen=this,e.placeOnOpen(!0),jQuery(document.body).addClass("dealer-page-open"),e.dom.show(),setTimeout(function(){e.isOpen=!0,e.placeOnOpen()},305);this.locator.pushState(this.titlePage,this.urlPage)}DealerLocator.Select.currentOpennedSelect&&DealerLocator.Select.currentOpennedSelect.close()},close:function(){var e=this;if(this.isOpen){jQuery(".sectionLoc-title").removeClass("active"),jQuery(".dealer-map-bt").addClass("active"),jQuery(document.body).removeClass("dealer-page-open"),DealerLocator.Page.currentPageOpen=null;var t=jQuery(".sectionLoc");t.css({bottom:""}),setTimeout(function(){e.isOpen=!1,e.dom.hide(),t.css({bottom:""})},305),this.locator.pushState(this.closeTitlePage,this.closeUrlPage)}}},DealerLocator.Page.PageInfinitScroll=function(e,t){DealerLocator.Page.call(this,e,t),this.injectInfinitScroll()},DealerLocator.Page.PageInfinitScroll.prototype=Object.create(DealerLocator.Page.prototype),jQuery.extend(DealerLocator.Page.PageInfinitScroll.prototype,{domInfinitScroll:null,intervalId:null,injectInfinitScroll:function(){var e=this;this.domInfinitScroll=this.getTemplator().render("infinitScroll").find(" > div").appendTo(this.dom.find(".infinitScroll-result")),this.intervalId=setInterval(function(){e.infinitScrollIsVisible()&&(e.displayInfinitScroll(),e.intervalId&&(clearInterval(e.intervalId),e.intervalId=null))},200)},destroyInfinitScroll:function(){this.removeInfinitScroll(),this.injectInfinitScroll()},removeInfinitScroll:function(){this.domInfinitScroll&&(this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),this.domInfinitScroll.remove(),this.domInfinitScroll=null)},infinitScrollIsVisible:function(){if(this.domInfinitScroll.is(":visible")&&this.domInfinitScroll){var e=jQuery(window),t=e.scrollTop(),o=t+e.height(),r=this.domInfinitScroll.offset().top-100;return r+this.domInfinitScroll.outerHeight(!0)<=o&&r>=t}return!1},getTemplator:function(){return this.locator.templator},displayInfinitScroll:function(){}}),DealerLocator.Page.PageBrandtore=function(e){DealerLocator.Page.PageInfinitScroll.call(this,e,"dealer-page-brandstores"),this.domBtOpen=e.dom.find(".dealer-page-brandstores-bt"),this.domResult=this.dom.find(".brandstores-stores"),this.domSelectCountry=this.dom.find("select"),this.urlPage=this.locator.dom.attr("data-url-page-brandtores"),this.titlePage=this.locator.dom.attr("data-title-page-brandtores"),this.btActive=this.domBtOpen,this.initEventBrandstore(),this.displayTitle()},DealerLocator.Page.PageBrandtore.prototype=Object.create(DealerLocator.Page.PageInfinitScroll.prototype),jQuery.extend(DealerLocator.Page.PageBrandtore.prototype,{domBtOpen:null,domSelectCountry:null,domResult:null,currentScroll:1,initEventBrandstore:function(){var e=this;this.domBtOpen.click(function(t){return t.preventDefault(),e.open(),!1}),this.domSelectCountry.change(function(){e.locator.pushState(null,null,{"br-lang":this.value}),e.onCountryChange()})},onCountryChange:function(){this.currentScroll=1,this.domResult.empty(),this.destroyInfinitScroll(),this.displayTitle()},displayTitle:function(){var e=this.dom.find(".brandstores-result > h4");this.domSelectCountry.val()?(e.html(this.domSelectCountry.find("option:selected").text()),e.show()):e.hide()},displayInfinitScroll:function(){var e=this,t=this.locator.dom.attr("data-url-brandstores");jQuery.ajax(t,{async:!0,dataType:"json",data:{page:this.currentScroll,country:this.domSelectCountry.val()},success:function(t){e.successLoadBrandstores(t)},error:function(e,t,o){}})},successLoadBrandstores:function(e){if(this.removeInfinitScroll(),e&&e.brandstores&&e.brandstores.length){for(var t=0;t<e.brandstores.length;t++){var o=e.brandstores[t];o.hours=null
;this.getTemplator().render("infoBox-result",o).appendTo(this.domResult).find("br").replaceWith(" ")}this.currentScroll++,this.injectInfinitScroll()}}}),DealerLocator.Page.PagePartner=function(e){DealerLocator.Page.PageInfinitScroll.call(this,e,"dealer-page-partners"),this.domBtOpen=e.dom.find(".dealer-page-partners-bt"),this.domResult=this.dom.find(".partners-result"),this.domSelectCountry=this.dom.find("select"),this.urlPage=this.locator.dom.attr("data-url-page-onlinepartners"),this.titlePage=this.locator.dom.attr("data-title-page-onlinepartners"),this.btActive=this.domBtOpen,this.initEventPartner()},DealerLocator.Page.PagePartner.prototype=Object.create(DealerLocator.Page.PageInfinitScroll.prototype),jQuery.extend(DealerLocator.Page.PagePartner.prototype,{domBtOpen:null,domSelectCountry:null,domResult:null,currentScroll:1,initEventPartner:function(){var e=this;this.domBtOpen.click(function(t){return t.preventDefault(),e.open(),!1}),this.domSelectCountry.change(function(){e.locator.pushState(null,null,{"op-lang":this.value}),e.onCountryChange()})},onCountryChange:function(){this.currentScroll=1,this.domResult.empty(),this.destroyInfinitScroll()},displayInfinitScroll:function(){var e=this,t=this.locator.dom.attr("data-url-onlinepartners");jQuery.ajax(t,{async:!0,dataType:"json",data:{page:this.currentScroll,country:this.domSelectCountry.val()},success:function(t){e.successLoadPartner(t)},error:function(e,t,o){}})},successLoadPartner:function(e){if(this.removeInfinitScroll(),e&&e.partners&&e.partners.length){this.getTemplator().render("onlinepartners",e).find(" > div").appendTo(this.domResult);this.currentScroll++,this.injectInfinitScroll()}}}),define("dealerLocator/dealer-locator",function(){}),define("dealerLocator/dealer-locator-init",["dealerLocator/dealer-locator"],function(){jQuery(window).ready(function(){new DealerLocator("#main-wrapper-inner")})});